#!/bin/bash

# GitHub Easy Mobile - CodeMagic Setup Script
# Ø§ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ø±ÙˆÚ˜Ù‡ Ø±Ø§ Ø¨Ø±Ø§ÛŒ CodeMagic Ø¢Ù…Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

echo "ðŸš€ Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¨Ø±Ø§ÛŒ CodeMagic..."

# Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
echo "âœ… Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ..."

required_files=(
    "codemagic.yaml"
    "gradle/wrapper/gradle-wrapper.properties"
    "gradle/wrapper/gradle-wrapper.jar"
    "gradlew"
    "app/build.gradle"
)

missing_files=()

for file in "${required_files[@]}"; do
    if [ ! -f "$file" ]; then
        missing_files+=("$file")
    fi
done

if [ ${#missing_files[@]} -gt 0 ]; then
    echo "âŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙÙ‚ÙˆØ¯:"
    printf '   %s\n' "${missing_files[@]}"
    exit 1
fi

echo "âœ… Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª!"

# Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ØªØ³Øª Gradle Wrapper
echo "ðŸ”§ ØªØ³Øª Gradle Wrapper..."
chmod +x gradlew
./gradlew --version

if [ $? -eq 0 ]; then
    echo "âœ… Gradle Wrapper Ø¯Ø±Ø³Øª Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯!"
else
    echo "âŒ Ø®Ø·Ø§ Ø¯Ø± Gradle Wrapper"
    exit 1
fi

# Ø³Ø§Ø®Øª keystore Ø¨Ø±Ø§ÛŒ release (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
echo ""
echo "ðŸ”‘ Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ keystore Ø¨Ø±Ø§ÛŒ release Ø¨Ø³Ø§Ø²ÛŒØ¯ØŸ (y/n)"
read -r create_keystore

if [ "$create_keystore" = "y" ] || [ "$create_keystore" = "Y" ]; then
    echo "ðŸ” Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª keystore..."
    
    keystore_name="release.keystore"
    
    if [ -f "$keystore_name" ]; then
        echo "âš ï¸  keystore Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³ØªØŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø´ÙˆØ¯ØŸ (y/n)"
        read -r overwrite
        if [ "$overwrite" != "y" ] && [ "$overwrite" != "Y" ]; then
            echo "ðŸš€ Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ù‡ CodeMagic!"
            exit 0
        fi
    fi
    
    echo "â„¹ï¸  Ø§Ø·Ù„Ø§Ø¹Ø§Øª keystore Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:"
    keytool -genkey -v -keystore "$keystore_name" -keyalg RSA -keysize 2048 -validity 10000 -alias release
    
    echo ""
    echo "âœ… Keystore Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯!"
    echo "ðŸ“‹ Ø¯Ø± CodeMagic Ø§ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:"
    echo "   - ÙØ§ÛŒÙ„ keystore: $keystore_name"
    echo "   - Alias: release"
    echo "   - Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± keystore: (Ù‡Ù…Ø§Ù† Ú©Ù„Ù…Ù‡ Ø¹Ø¨ÙˆØ±ÛŒ Ú©Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯ÛŒØ¯)"
fi

echo ""
echo "ðŸŽ‰ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ CodeMagic Ø§Ø³Øª!"
echo ""
echo "ðŸ“‹ Ù…Ø±Ø§Ø­Ù„ Ø¨Ø¹Ø¯ÛŒ:"
echo "1. Ù¾Ø±ÙˆÚ˜Ù‡ Ø±Ø§ Ø¯Ø± GitHub Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯"
echo "2. Ø¯Ø± CodeMagic Ø«Ø¨Øª Ù†Ø§Ù… Ú©Ù†ÛŒØ¯"
echo "3. Ù…Ø®Ø²Ù† GitHub Ø±Ø§ Ø¨Ù‡ CodeMagic Ù…ØªØµÙ„ Ú©Ù†ÛŒØ¯"
echo "4. Build Ø±Ø§ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯"
echo ""
echo "ðŸ“– Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„ØŒ ÙØ§ÛŒÙ„ CODEMAGIC_GUIDE.md Ø±Ø§ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ú©Ù†ÛŒØ¯"

# Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ git
echo ""
echo "ðŸ“¦ Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù¾Ø±ÙˆÚ˜Ù‡ Ø±Ø§ Ø¯Ø± Git Ø¢Ù…Ø§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ØŸ (y/n)"
read -r prepare_git

if [ "$prepare_git" = "y" ] || [ "$prepare_git" = "Y" ]; then
    echo "ðŸ“‹ Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Git..."
    
    if [ ! -f ".gitignore" ]; then
        cat > .gitignore << EOF
# Built application files
*.apk
*.aab
*.ap_
*.aab

# Files for the ART/Dalvik VM
*.dex

# Java class files
*.class

# Generated files
bin/
gen/
out/
#  Uncomment the following line in case you need and you don't have the release build type files in your app
# release/

# Gradle files
.gradle/
build/

# Local configuration file (sdk path, etc)
local.properties

# Proguard folder generated by Eclipse
proguard/

# Log Files
*.log

# Android Studio Navigation editor temp files
.navigation/

# Android Studio captures folder
captures/

# IntelliJ
*.iml
.idea/workspace.xml
.idea/tasks.xml
.idea/gradle.xml
.idea/assetWizardSettings.xml
.idea/dictionaries
.idea/libraries
# Android Studio 3 in .gitignore file.
.idea/caches
.idea/modules.xml
# Comment next line if keeping position of elements in Navigation Editor is relevant for you
.idea/navEditor.xml

# Keystore files
# Uncomment the following lines if you do not want to check your keystore files in.
#*.jks
#*.keystore

# External native build folder generated in Android Studio 2.2 and later
.externalNativeBuild
.cxx/

# Google Services (e.g. APIs or Firebase)
# google-services.json

# Freeline
freeline.py
freeline/
freeline_project_description.json

# fastlane
fastlane/report.xml
fastlane/Preview.html
fastlane/screenshots
fastlane/test_output
fastlane/readme.md

# Version control
.vcs.xml

# lint
lint/intermediates/
lint/generated/
lint/outputs/
lint/tmp/
# lint/reports/

# Android Profiling
*.hprof

# Keystore files
#*release.keystore
*.jks
*.keystore

# Mac system files
.DS_Store
EOF
        echo "âœ… ÙØ§ÛŒÙ„ .gitignore Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯"
    fi
    
    git init
    git add .
    git commit -m "Initial commit - GitHub Easy Mobile for CodeMagic"
    
    echo ""
    echo "âœ… Git Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!"
    echo "ðŸ”— Ø­Ø§Ù„Ø§ Ù…Ø®Ø²Ù† GitHub Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯ Ùˆ Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ±Ø§Øª Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯:"
    echo "   git remote add origin YOUR_GITHUB_REPO_URL"
    echo "   git branch -M main"
    echo "   git push -u origin main"
fi

echo ""
echo "ðŸš€ Ù¾Ø±ÙˆÚ˜Ù‡ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ CodeMagic Ø§Ø³Øª!"